<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2026-01-29 Thu 11:26 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Testing and Debugging in ROS and C++</title>
<meta name="author" content="Matthew Elwin" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="./../pubme.css" type="text/css"/>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../index.html"> UP </a>
 |
 <a accesskey="H" href="./../index.html"> HOME </a>
</div><div id="content" class="content">
<header>
<h1 class="title">Testing and Debugging in ROS and C++</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#overview-1-P-9">Overview</a></li>
<li><a href="#levels-of-ros-testing-1-P-1">Levels of ROS testing</a>
<ul>
<li><a href="#library-level-unit-tests-2-P-1">Library-level unit tests</a></li>
<li><a href="#single-node-unit-tests-2-P-1">Single Node Unit Tests</a></li>
<li><a href="#integration-test-2-P-1">Integration Test</a></li>
</ul>
</li>
<li><a href="#c-unit-testing-framework-1-P-1">C++ Unit Testing Framework</a>
<ul>
<li><a href="#catch2-2-P-1">Catch2</a></li>
<li><a href="#quick-guide-2-P-1">Quick Guide</a></li>
<li><a href="#google-test-gtest--2-P-1">Google Test (GTest)</a></li>
</ul>
</li>
<li><a href="#debugging-1-P-1">Debugging</a>
<ul>
<li><a href="#from-launchfiles-2-P-1">From Launchfiles</a></li>
</ul>
</li>
<li><a href="#references-1-P-2">References</a></li>
</ul>
</div>
</nav>
<div id="outline-container-overview-1-P-9" class="outline-2">
<h2 id="overview-1-P-9">Overview</h2>
</div>

<div id="outline-container-levels-of-ros-testing-1-P-1" class="outline-2">
<h2 id="levels-of-ros-testing-1-P-1">Levels of ROS testing</h2>
<div class="outline-text-2" id="text-levels-of-ros-testing-1-P-1">
</div>
<div id="outline-container-library-level-unit-tests-2-P-1" class="outline-3">
<h3 id="library-level-unit-tests-2-P-1">Library-level unit tests</h3>
<div class="outline-text-3" id="text-org1616af1">
<ul class="org-ul">
<li>These tests are independent of ROS and are used for testing individual functions and libraries.</li>
<li>Each test should be small and (ideally) run quickly</li>
<li>Ideally these tests are designed to run every time you compile (or at least
every time immediately prior to merging your code into the master)</li>
</ul>
</div>
</div>
<div id="outline-container-single-node-unit-tests-2-P-1" class="outline-3">
<h3 id="single-node-unit-tests-2-P-1">Single Node Unit Tests</h3>
<div class="outline-text-3" id="text-orga236e13">
<ul class="org-ul">
<li>The goal is to validate the functionality of a single Node</li>
<li>Test its publishers, subscribers, and servers, and parameter usage</li>
<li>These tests should also be relatively small and self contained</li>
<li>They can be set up to run as part of the compilation process</li>
</ul>
</div>
</div>
<div id="outline-container-integration-test-2-P-1" class="outline-3">
<h3 id="integration-test-2-P-1">Integration Test</h3>
<div class="outline-text-3" id="text-org2811e59">
<p>
These tests start multiple nodes and test how the whole system works together
</p>
<ul class="org-ul">
<li>These tests are made in the same way as single node unit tests, but launch more ROS nodes</li>
<li>Some integration tests can be done automatically as part of the compilation process</li>
<li>Some integration tests may require physical robot hardware</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-c-unit-testing-framework-1-P-1" class="outline-2">
<h2 id="c-unit-testing-framework-1-P-1">C++ Unit Testing Framework</h2>
<div class="outline-text-2" id="text-orgebf026d">
<p>
There is no standard unit-testing framework for C++. We will use
<a href="https://github.com/catchorg/Catch2">Catch2 (version 3)</a> in this class, but these
notes also discuss <code>gtest</code>.
</p>
</div>
<div id="outline-container-catch2-2-P-1" class="outline-3">
<h3 id="catch2-2-P-1">Catch2</h3>
<div class="outline-text-3" id="text-catch2-2-P-1">
</div>
<div id="outline-container-overview-3-P-1" class="outline-4">
<h4 id="overview-3-P-1">Overview</h4>
<div class="outline-text-4" id="text-org7802a84">
<ul class="org-ul">
<li>Catch2 is a light-weight unit-testing framework for C++</li>
<li>The <a href="https://github.com/catchorg/Catch2/blob/devel/docs/tutorial.md#top">Tutorial</a></li>
<li>The <a href="https://github.com/catchorg/Catch2/blob/devel/docs/Readme.md#top">Reference Documentation</a></li>
<li>The <a href="https://index.ros.org/p/catch_ros2/">catch_ros2</a> package enables the use of Catch2 with ROS 2</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-quick-guide-2-P-1" class="outline-3">
<h3 id="quick-guide-2-P-1">Quick Guide</h3>
<div class="outline-text-3" id="text-org0e45ab9">
<ul class="org-ul">
<li>The <a href="https://github.com/ngmor/catch_ros2/tree/main/">catch_ros2 documentation</a> provides full usage instructions.</li>
<li>To do regular unit tests, right the Catch tests as usual, then link the executable with
<code>target_link_libraries(mytests catch_ros2::catch_ros2_with_main)</code>
<ul class="org-ul">
<li>This automatically provides a main for the test, but there are other options</li>
</ul></li>
<li>To do integration testing requires
<ol class="org-ol">
<li>The nodes you want to test</li>
<li>A <a href="https://github.com/ngmor/catch_ros2/blob/main/examples/integration_test/integration_test_node.cpp">Integration Testing Node</a>
<ul class="org-ul">
<li>This node uses Catch2 to run test the node</li>
</ul></li>
<li>A <a href="https://github.com/ngmor/catch_ros2/blob/main/examples/integration_test/example_integration_test.launch.xml">Launch File</a>
<ul class="org-ul">
<li>This node launches the nodes the node that should be tested and the test node itself</li>
</ul></li>
<li>Add <code>catch_ros2_add_integration_test(MyTest LAUNCH_FILE my_launchfile TIMEOUT 60)</code> to CMake if you want the test to run with <code>colcon test</code>.
<ul class="org-ul">
<li><code>TIMEOUT</code> defaults to 60 and can be ommited, but it is useful to increase the timeout if running the test node in gdb</li>
<li>The test can also be run by running the test launch file</li>
</ul></li>
</ol></li>
</ul>
</div>
</div>
<details id="orgd4268ba"><summary class="header-3">Google Test (GTest)</summary>
<div id="outline-container-overview-3-P-2" class="outline-4">
<h4 id="overview-3-P-2">Overview</h4>
<div class="outline-text-4" id="text-org4d9f712">
<ul class="org-ul">
<li>The most common C++ unit testing framework in ROS is Google Test.</li>
<li><a href="https://github.com/google/googletest/blob/master/googletest/docs/primer.md">Google Test Primer</a></li>
<li><a href="https://github.com/google/googletest/blob/master/googletest/docs/advanced.md">Google Test Advanced</a> (Not too advanced for you)</li>
<li><a href="https://docs.ros.org/en/iron/Tutorials/Intermediate/Testing/Cpp.html">ROS 2 GTest Tutorial</a></li>
</ul>
</div>
</div>
</details>
</div>

<div id="outline-container-debugging-1-P-1" class="outline-2">
<h2 id="debugging-1-P-1">Debugging</h2>
<div class="outline-text-2" id="text-orgb6f994f">
<ul class="org-ul">
<li>Using <code>gdb</code> can greatly help you track down issues in your program
<ul class="org-ul">
<li>Among other features, it enables you to step through the code, examine variables, and break on certain lines</li>
</ul></li>
<li>use <code>ros2 run --prefix "gdb --args" package node</code>  to launch the node in <code>gdb</code></li>
<li>Commands that may be useful are
<ul class="org-ul">
<li><code>tui enable</code> to view a graphical interface with easier commands</li>
<li><code>run</code> start running the program. Abbreviated with <code>r</code></li>
<li><code>continue</code> continue running a paused program. Abbreviated with <code>c</code></li>
<li><code>break file:line</code> or <code>break function</code> to put a breakpoint at a line or a function. Abbreviated with <code>b</code></li>
<li><code>next</code> go to the next line, skipping over functions. Abbreviated with <code>n</code></li>
<li><code>step</code> go to the next line, jumping into functions. Abbreviated with <code>s</code></li>
<li><code>print</code> display the value of a variable or memory address</li>
</ul></li>
<li>To use <code>gdb</code> most effectively, the code must be compiled with Debugging symbols enabled
<ul class="org-ul">
<li>Use the <code>Debug</code> build type in <code>CMake</code>. See <a href="./cmake_basics.html">CMake Notes</a> for how to set debugging mode</li>
</ul></li>
</ul>
</div>

<div id="outline-container-from-launchfiles-2-P-1" class="outline-3">
<h3 id="from-launchfiles-2-P-1">From Launchfiles</h3>
<div class="outline-text-3" id="text-org35b2424">
<p>
Launching a node in GDB from a launchfile requires extra consideration because you do not have access to a terminal for the node by default
(the <code>ros2 launch</code> command controls input from the terminal). Instead we will use <code>gdbserver</code>, which allows remote debugging
</p>

<ol class="org-ol">
<li>Use <code>launch-prefix</code> to start <code>gdbserver</code>:
<ul class="org-ul">
<li>XML Launch File: <code>&lt;node ... launch-prefix</code>'gdbserver :3000'&gt;=</li>
<li>Python Launch File ~Node(&#x2026;, prefix=['gdbserver :3000'])</li>
<li>The <code>:3000</code> is the port, the number is somewhat arbitrary (as long as it doesn't conflict with other open ports).</li>
<li>This same argument works when using the <code>&lt;catch_ros2_node&gt;</code> tag</li>
</ul></li>

<li>Run <code>gdb</code> and connect to the server using <code>remote target :3000</code> (or the port you specified above)
<ul class="org-ul">
<li>You can now use <code>gdb</code> as usual.</li>
</ul></li>
<li>Alternatively, you can use a prefix command to run <code>gdb</code> in a new terminal window (e.g., <code>xterm</code>).
<ul class="org-ul">
<li><code>xterm -e gdb -ex run --args</code></li>
<li>This method is in some ways more straightforward: it will launch a new <code>xterm</code> window</li>
<li>However, it is also dependent on the availability of a gui (e.g., will not work over ssh).</li>
</ul></li>
<li>In a pinch, you can comment out the start of the node in the launchfile and manually run  it with <code>ros2 run</code></li>
</ol>
</div>
</div>
</div>


<div id="outline-container-references-1-P-2" class="outline-2">
<h2 id="references-1-P-2">References</h2>
<div class="outline-text-2" id="text-org85f6cb0">
<ul class="org-ul">
<li><a href="https://docs.ros.org/en/iron/Tutorials/Intermediate/Testing/Testing-Main.html">ROS 2 Testing Overview</a></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p><p class="outline-2">Author: Matthew Elwin. </p></p>
</div>
</body>
</html>
